<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="he">
<head>
    <meta charset="UTF-8">
    <title>סטטיסטיקות מערכת</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            direction: rtl;
        }
        .container {
            padding: 3rem 2rem;
        }
        .stat-box {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.05);
            padding: 2rem;
            text-align: center;
        }
        .stat-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #495057;
        }
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #198754;
        }
        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            text-align: center;
            margin-top: 2rem;
            margin-bottom: 0.5rem;
            color: #212529;
        }
        canvas {
            max-width: 700px;
            margin: 0 auto 3rem auto;
            display: block;
        }
    </style>
</head>
<body>
<div class="text-center my-4">
    <a href="/admin/home" class="btn btn-outline-success btn-lg">חזרה לדף הראשי</a>
</div>

<div class="container">
    <h2 class="text-center text-success fw-bold mb-4">סטטיסטיקות כלליות</h2>

    <!-- כרטיסי נתונים -->
    <div class="row g-4">
        <div class="col-md-3 col-6">
            <div class="stat-box">
                <div class="stat-title">סה"כ בקשות</div>
                <div class="stat-value" th:text="${totalNeeds}">--</div>
            </div>
        </div>
        <div class="col-md-3 col-6">
            <div class="stat-box">
                <div class="stat-title">סה"כ הצעות</div>
                <div class="stat-value" th:text="${totalOffers}">--</div>
            </div>
        </div>
        <div class="col-md-3 col-6">
            <div class="stat-box">
                <div class="stat-title">סה"כ שידוכים</div>
                <div class="stat-value" th:text="${totalMatches}">--</div>
            </div>
        </div>
        <div class="col-md-3 col-6">
            <div class="stat-box">
                <div class="stat-title">שידוכים מוצלחים</div>
                <div class="stat-value" th:text="${matchedCount}">--</div>
            </div>
        </div>
    </div>

    <!-- גרפים -->
    <div class="chart-title">פיזור בקשות לפי סוג עזרה</div>
    <canvas id="helpTypeChart"></canvas>

    <div class="chart-title">פיזור בקשות לפי אזור</div>
    <canvas id="regionChart"></canvas>

    <div class="chart-title">פיזור הצעות לפי זמן מועדף</div>
    <canvas id="timeChart"></canvas>

    <div class="chart-title">פיזור סטטוסים של שידוכים</div>
    <canvas id="matchStatusChart"></canvas>
</div>

<!-- סקריפטים לגרפים -->
<script th:inline="javascript">
    const helpTypeLabels = [[${helpTypeLabels}]];
    const helpTypeCounts = [[${helpTypeCounts}]];
    const regionLabels = [[${regionLabels}]];
    const regionCounts = [[${regionCounts}]];
    const timeSlotLabels = [[${timeSlotLabels}]];
    const timeSlotCounts = [[${timeSlotCounts}]];
    const matchStatusLabels = [[${matchStatusLabels}]];
    const matchStatusCounts = [[${matchStatusCounts}]];

    const helpTypeChart = new Chart(document.getElementById('helpTypeChart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: helpTypeLabels,
            datasets: [{
                label: 'בקשות לפי סוג עזרה',
                data: helpTypeCounts,
                backgroundColor: ['#4dc9f6','#f67019','#f53794','#537bc4','#acc236','#166a8f','#58595b','#8d6cab'],
                borderRadius: 8,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
        }
    });

    const regionChart = new Chart(document.getElementById('regionChart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: regionLabels,
            datasets: [{
                label: 'בקשות לפי אזור',
                data: regionCounts,
                backgroundColor: '#20c997',
                borderRadius: 8,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
        }
    });

    const timeChart = new Chart(document.getElementById('timeChart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: timeSlotLabels,
            datasets: [{
                label: 'הצעות לפי זמן מועדף',
                data: timeSlotCounts,
                backgroundColor: '#fd7e14',
                borderRadius: 8,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
        }
    });

    const matchStatusChart = new Chart(document.getElementById('matchStatusChart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: matchStatusLabels,
            datasets: [{
                label: 'שידוכים לפי סטטוס',
                data: matchStatusCounts,
                backgroundColor: '#0d6efd',
                borderRadius: 8,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
        }
    });
</script>

</body>
</html>
